<properties urlDisplayName="Manage Availability of VMs" pageTitle="仮想マシンの可用性管理 - Azure" metaKeywords="" description="Learn how to use multiple virtual machines to ensure high availability for your Azure application. " metaCanonical="" services="virtual-machines" documentationCenter="" title="" authors="kenazk" solutions="" manager="timlt" editor="tysonn" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="11/26/2014" ms.author="kenazk" />

#仮想マシンの可用性管理

## 計画済み、または計画外メンテナンスについて理解する
仮想マシンの可用性に影響を与える可能性のある Azure プラットフォーム イベントには、計画的なメンテナンスと計画外のメンテナンスの 2 種類があります。

- **計画済みメンテナンス イベント**とは、仮想マシンを実行しているプラットフォーム インフラストラクチャの全体的な信頼性、パフォーマンス、セキュリティを向上させることを目的として、基盤となる Azure プラットフォームに対して Microsoft が提供する定期的な更新を意味します。これらの更新のほとんどは、仮想マシンやクラウド サービスに影響を及ぼすことなく実行されます。ただし、プラットフォーム インフラストラクチャに必要な更新を適用するため、仮想マシンの再起動が求められる場合もあります。 

- **計画外メンテナンス イベント**は、仮想マシンの基盤となっているハードウェアや物理インフラストラクチャになんらかの不具合が発生した場合に行われます。こうした不具合には、ネットワーク障害、ローカル ディスク障害、またはその他のラック レベルでの障害が挙げられます。そのような障害が検知されると、Azure プラットフォームは、仮想マシンをホストしている異常な物理マシンから正常な物理マシンへと、仮想マシンを自動的に移行します。このような例が発生することはまれですが、この場合も仮想マシンの再起動が求められる場合があります。 

## ベスト プラクティスに基づいて高可用性のアプリケーションを設計する
前述のようなイベントが 1 つ以上発生した場合にダウンタイムの影響を低減するため、下記のような高可用性のためのベスト プラクティスを仮想マシンに適用することをお勧めします。

* [冗長性実現のために複数の仮想マシンを可用性セット内に構成する] 
* [各アプリケーション層に対して別々の可用性セットを構成する] 
* [ロード バランサーと可用性セットを結合する] 
* [可用性セット内の仮想マシンが 1 つのみにならないようにする] 

### 冗長性実現のために複数の仮想マシンを可用性セット内に構成する 
アプリケーションに冗長性をもたらすには、可用性セット内に 2 つ以上の仮想マシンをグループ化することをお勧めします。このような構成により、計画済み、または計画外メンテナンス イベント中に、少なくとも 1 つの仮想マシンが利用可能となり、99.95% の Azure SLA を満たします。サービス レベル アグリーメントの詳細については、「[サービス レベル アグリーメント](../../../support/legal/sla/)」の「クラウド サービス、仮想マシン、仮想ネットワーク」のセクションを参照してください。 

基盤を成す Azure プラットフォームにより、可用性セット内の各仮想マシンに更新ドメイン (UD) と障害ドメイン (FD) が割り当てられます。所定の可用性セットに対して、同時に再起動される仮想マシンのグループと物理ハードウェアを示す UD (ユーザーによる構成不可) が 5 つ割り当てられます。1 つの可用性セット内に 5 つ以上の仮想マシンが構成されている時、6 つ目の仮想マシンは 1 つ目の仮想マシンと同じ UD 内に配置され、7 つ目は 2 つ目の仮想マシンと同じ UD 内に配置されるといった具合に続きます。計画済みメンテナンス中、UD の再起動は順番に処理されない場合がありますが、一度に再起動される UD は 1 つのみです。

FD は電源とネットワーク スイッチを共有する仮想マシンのグループを定義します。既定では、可用性セット内に構成された仮想マシンは、2 つの FD に分けられます。仮想マシンを可用性セットに配置しても、アプリケーションがオペレーティング システムやアプリケーションの障害から保護されるわけではありませんが、潜在的な物理ハードウェア障害、ネットワーク障害、または電力の中断の影響を低下させることができます。   

<!--Image reference-->
   ![UD FD configuration](./media/virtual-machines-manage-availability/ud-fd-configuration.png)

>[WACOM.NOTE] 手順については、「[仮想マシンの可用性セットを構成する方法]」を参照してください[]。

### 各アプリケーション層に対して別々の可用性セットを構成する
可用性セット内の仮想マシンがすべてほぼ同一で、アプリケーションに対する役割が同じである場合は、アプリケーションの各層に対して別々の可用性セットを構成することをお勧めします。同じ可用性セットの中に 2 つの異なる層を配置した場合、同じアプリケーション層内にあるすべての仮想マシンが一度に再起動されます。各層に対する別々の可用性セット内に少なくとも 2 つの仮想マシンを構成することで、各層あたり 1 つ以上の仮想マシンの可用性が確保されます。   

たとえば、ISS、Apache、Nginx などを実行しているアプリケーションのフロントエンド内のすべての VM を、1 つの可用性セットに配置します。このとき、フロントエンド仮想マシンのみが同じ可用性セット内に配置されるようにします。同様に、別の可用性セットには、複製された SQL Server VM または MySQL VM のように、データ層の仮想マシンのみが配置されるようにします。

<!--Image reference-->
   ![Application tiers](./media/virtual-machines-manage-availability/application-tiers.png)

 
### ロード バランサーと可用性セットを結合する
Azure ロード バランサーと可用性セットを結合することで、アプリケーションの復元性を最大化できます。Azure ロード バランサーは、複数の仮想マシンにトラフィックを振り分けます。当社の標準層の仮想マシンには Azure ロード バランサーが含まれています。すべての仮想マシン層に Azure ロード バランサーが含まれているわけではないので注意してください。仮想マシンの負荷分散の詳細については、「[仮想マシンの負荷分散](../load-balance-virtual-machines/)」を参照してください。 

複数の仮想マシン間でトラフィックを分散するためのロード バランサーが構成されていない場合、計画済みメンテナンス イベントによって、トラフィックを提供している仮想マシンのみに影響が生じ、アプリケーション層の機能停止が生じます。同じ層の複数の仮想マシンを、同じロード バランサーと可用性セット以下に配置することで、少なくとも 1 つのインスタンスによってトラフィックの提供を継続することができます。 

### 可用性セット内の仮想マシンが 1 つのみにならないようにする
可用性セット内の仮想マシンが 1 つのみにならないようにしてくだい。この構成の仮想マシンは、SLA 保証の対象とはならず、Azure の計画されたメンテナンス イベント時にダウンタイムが発生します。さらに、可用性セット内に 1 つの VM を配備する場合、プラットフォーム メンテナンスの事前警告や通知は送付されません。この構成では、プラットフォーム メンテナンス時に事前警告なく 1 つの仮想マシンが再起動されます。

[冗長性実現のために複数の仮想マシンを可用性セット内に構成する]: #configure-multiple-virtual-machines-in-an-availability-set-for-redundancy 
[各アプリケーション層に対して別々の可用性セットを構成する]: #configure-each-application-tier-into-separate-availability-sets 
[ロード バランサーと可用性セットを結合する]: #combine-the-load-balancer-with-availability-sets 
[可用性セット内の仮想マシンが 1 つのみにならないようにする]: #avoid-single-instance-virtual-machines-in-availability-sets 

 
<!-- Link references -->
[仮想マシンの可用性セットを構成する方法]: ../virtual-machines-how-to-configure-availability



<!--HONumber=35.1-->
